# SAPO - Configuración de seguridad Apache

# Deshabilitar listado de directorios
Options -Indexes

# Proteger archivos sensibles
<FilesMatch "^\.">
    Require all denied
</FilesMatch>

# Proteger archivos JSON y configuración
<FilesMatch "\.(json)$">
    Require all denied
</FilesMatch>

<Files "config.php">
    Require all denied
</Files>

# Proteger directorio de includes
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{REQUEST_URI} /includes/ [NC]
    RewriteRule .* - [F,L]
</IfModule>

# Proteger directorio db/
<IfModule mod_rewrite.c>
    RewriteCond %{REQUEST_URI} /db/ [NC]
    RewriteRule .* - [F,L]
</IfModule>

# Headers de seguridad adicionales (si mod_headers está disponible)
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    # Descomentar si se usa HTTPS:
    # Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
</IfModule>

# X-Frame-Options para todo EXCEPTO parrilla_cards.php (permite embedding del widget)
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{REQUEST_URI} !parrilla_cards\.php
    RewriteRule .* - [E=NEED_FRAME_OPTIONS:1]
</IfModule>
<IfModule mod_headers.c>
    Header always set X-Frame-Options "SAMEORIGIN" env=NEED_FRAME_OPTIONS
</IfModule>

# Prevenir ataques de inyección de NULL byte
<IfModule mod_rewrite.c>
    RewriteCond %{QUERY_STRING} \0 [OR]
    RewriteCond %{QUERY_STRING} \%00
    RewriteRule .* - [F,L]
</IfModule>

# Limitar tamaño de peticiones (prevenir DoS)
<IfModule mod_security.c>
    SecRequestBodyLimit 10485760
</IfModule>

# Deshabilitar ejecución de PHP en directorios de uploads (si existieran)
<IfModule mod_php7.c>
    php_flag engine off
</IfModule>

# Tipo MIME correcto para archivos JSON
<IfModule mod_mime.c>
    AddType application/json .json
</IfModule>

# Deshabilitar servidor de información
ServerSignature Off
